<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm Tra Ethereum RPC Proxy</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #3498db;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .section h2 {
            margin-top: 0;
            color: #3498db;
        }
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        input, select, button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        input, select {
            flex: 1;
            min-width: 150px;
        }
        button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .response {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            margin-top: 10px;
            font-weight: bold;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        .examples {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }
        .example-card {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .example-card:hover {
            background-color: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .example-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #3498db;
        }
        .example-body {
            font-family: monospace;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .tab-container {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .tab {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px 4px 0 0;
            background-color: #f8f9fa;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kiểm Tra Ethereum RPC Proxy</h1>
        
        <div class="section">
            <h2>Thông Tin Cấu Hình</h2>
            <div class="control-panel">
                <input type="text" id="proxyUrl" placeholder="URL Proxy (ví dụ: http://127.0.0.1:8545)" value="http://127.0.0.1:8545">
                <button onclick="checkServerStatus()">Kiểm Tra Trạng Thái</button>
            </div>
            <div id="statusResponse" class="response"></div>
        </div>

        <div class="section">
            <h2>Gửi Yêu Cầu Ethereum JSON-RPC</h2>
            
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('predefined')">Các ví dụ mẫu</div>
                <div class="tab" onclick="switchTab('custom')">Tùy chỉnh</div>
            </div>
            
            <div id="predefinedTab">
                <div class="examples">
                    <div class="example-card" onclick="loadExample('blockNumber')">
                        <div class="example-title">Lấy số block mới nhất</div>
                        <div class="example-body">method: eth_blockNumber</div>
                    </div>
                    <div class="example-card" onclick="loadExample('getBalance')">
                        <div class="example-title">Lấy số dư ETH</div>
                        <div class="example-body">method: eth_getBalance, params: ["0x...""]</div>
                    </div>
                    <div class="example-card" onclick="loadExample('getTransactionCount')">
                        <div class="example-title">Lấy số giao dịch đã gửi</div>
                        <div class="example-body">method: eth_getTransactionCount</div>
                    </div>
                    <div class="example-card" onclick="loadExample('getCode')">
                        <div class="example-title">Lấy bytecode của smart contract</div>
                        <div class="example-body">method: eth_getCode</div>
                    </div>
                    <div class="example-card" onclick="loadExample('call')">
                        <div class="example-title">Gọi hàm trên smart contract</div>
                        <div class="example-body">method: eth_call</div>
                    </div>
                    <div class="example-card" onclick="loadExample('getLogs')">
                        <div class="example-title">Lấy logs từ smart contract</div>
                        <div class="example-body">method: eth_getLogs</div>
                    </div>
                </div>
            </div>
            
            <div id="customTab" style="display:none;">
                <div class="control-panel">
                    <input type="text" id="customMethod" placeholder="Tên phương thức (ví dụ: eth_blockNumber)">
                    <input type="text" id="customParams" placeholder="Các tham số JSON (ví dụ: [\"0x...\", \"latest\"])">
                </div>
            </div>
            
            <div class="control-panel">
                <button onclick="sendRequest()">Gửi Yêu Cầu</button>
            </div>
            
            <h3>Body của Request</h3>
            <div id="requestBody" class="response"></div>
            
            <h3>Kết Quả</h3>
            <div id="requestResponse" class="response"></div>
            <div id="requestStatus" class="status"></div>
        </div>

        <div class="section">
            <h2>Thử Nghiệm Trạng Thái Node</h2>
            <div class="control-panel">
                <button onclick="getNodeInfo()">Lấy Thông Tin Node</button>
            </div>
            <div id="nodeInfoResponse" class="response"></div>
        </div>
    </div>

    <script>
        let currentTab = 'predefined';
        let exampleData = {
            blockNumber: {
                method: 'eth_blockNumber',
                params: []
            },
            getBalance: {
                method: 'eth_getBalance',
                params: ['0x742d35Cc6634C0532925a3b844Bc454e4438f44e', 'latest']
            },
            getTransactionCount: {
                method: 'eth_getTransactionCount',
                params: ['0x742d35Cc6634C0532925a3b844Bc454e4438f44e', 'latest']
            },
            getCode: {
                method: 'eth_getCode',
                params: ['0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2', 'latest'] // WETH contract
            },
            call: {
                method: 'eth_call',
                params: [
                    {
                        to: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2', // WETH contract
                        data: '0x06fdde03' // name() function selector
                    },
                    'latest'
                ]
            },
            getLogs: {
                method: 'eth_getLogs',
                params: [
                    {
                        address: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2', // WETH contract
                        fromBlock: '0xE8E1C0', // Block in hex
                        toBlock: '0xE8E1C0',
                        topics: []
                    }
                ]
            }
        };

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            if (tab === 'predefined') {
                document.getElementById('predefinedTab').style.display = 'block';
                document.getElementById('customTab').style.display = 'none';
            } else {
                document.getElementById('predefinedTab').style.display = 'none';
                document.getElementById('customTab').style.display = 'block';
            }
            
            currentTab = tab;
        }

        function loadExample(example) {
            let data = exampleData[example];
            document.getElementById('customMethod').value = data.method;
            document.getElementById('customParams').value = JSON.stringify(data.params);
            
            // Hiển thị body request
            updateRequestBodyPreview(data.method, data.params);
        }

        function updateRequestBodyPreview(method, params) {
            const body = {
                jsonrpc: '2.0',
                id: 1,
                method: method,
                params: params
            };
            
            document.getElementById('requestBody').innerText = JSON.stringify(body, null, 2);
        }

        // Kiểm tra trạng thái máy chủ
        async function checkServerStatus() {
            const proxyUrl = document.getElementById('proxyUrl').value;
            const statusResponse = document.getElementById('statusResponse');
            
            try {
                statusResponse.innerText = 'Đang kiểm tra...';
                const response = await fetch(`${proxyUrl}/action/server-status`);
                const text = await response.text();
                statusResponse.innerText = text;
            } catch (error) {
                statusResponse.innerText = `Lỗi: ${error.message}`;
            }
        }

        // Gửi yêu cầu JSON-RPC
        async function sendRequest() {
            const proxyUrl = document.getElementById('proxyUrl').value;
            const requestResponse = document.getElementById('requestResponse');
            const requestStatus = document.getElementById('requestStatus');
            
            let method, params;
            
            // Lấy method và params dựa trên tab đang chọn
            method = document.getElementById('customMethod').value;
            try {
                params = JSON.parse(document.getElementById('customParams').value || '[]');
            } catch (e) {
                requestStatus.innerText = 'Lỗi: Tham số không phải JSON hợp lệ!';
                requestStatus.className = 'status error';
                return;
            }
            
            // Cập nhật xem trước body request
            updateRequestBodyPreview(method, params);
            
            try {
                requestResponse.innerText = 'Đang gửi yêu cầu...';
                requestStatus.innerText = '';
                requestStatus.className = 'status';
                
                // Tạo URL cho yêu cầu
                let url = `${proxyUrl}?action=ethereumRaw`;
                
                // Chuẩn bị body theo định dạng JSON-RPC 2.0
                const requestBody = {
                    jsonrpc: '2.0',
                    id: 1,
                    method: method,
                    params: params
                };
                
                // Sử dụng fetch với phương thức POST và body JSON
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.text();
                
                try {
                    // Cố gắng định dạng JSON nếu phản hồi là JSON
                    const jsonData = JSON.parse(data);
                    requestResponse.innerText = JSON.stringify(jsonData, null, 2);
                } catch {
                    // Nếu không phải JSON, hiển thị dưới dạng văn bản
                    requestResponse.innerText = data;
                }
                
                requestStatus.innerText = 'Yêu cầu thành công!';
                requestStatus.className = 'status success';
            } catch (error) {
                requestResponse.innerText = `Lỗi: ${error.message}`;
                requestStatus.innerText = 'Yêu cầu thất bại!';
                requestStatus.className = 'status error';
            }
        }

        // Lấy thông tin về các node
        async function getNodeInfo() {
            const proxyUrl = document.getElementById('proxyUrl').value;
            const nodeInfoResponse = document.getElementById('nodeInfoResponse');
            
            try {
                nodeInfoResponse.innerText = 'Đang lấy thông tin...';
                const response = await fetch(`${proxyUrl}/action/evm_admin`);
                const data = await response.text();
                
                try {
                    // Cố gắng định dạng JSON nếu phản hồi là JSON
                    const jsonData = JSON.parse(data);
                    nodeInfoResponse.innerText = JSON.stringify(jsonData, null, 2);
                } catch {
                    // Nếu không phải JSON, hiển thị dưới dạng văn bản
                    nodeInfoResponse.innerText = data;
                }
            } catch (error) {
                nodeInfoResponse.innerText = `Lỗi: ${error.message}`;
            }
        }

        // Khởi tạo trang
        document.addEventListener('DOMContentLoaded', function() {
            // Hiển thị body request mặc định
            updateRequestBodyPreview(exampleData.blockNumber.method, exampleData.blockNumber.params);
        });
    </script>
</body>
</html> 